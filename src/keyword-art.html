<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">

<!-- Gets top 5 art pieces relevant to given keyword -->
<dom-module id="keyword-art">

  <template>
    <style>
      :host {
        display: block;
        box-sizing: border-box;
      }
      .image-wrapper {
        padding-top: 30vh;
      }
      .image--gallery {
        border: none;
        height: 200px;
        width: inherit;
        position: relative;
        box-shadow: 16px 14px 0 0px #FFFFFF, 16px 14px 0 2px #1A09FF;
        margin:30px;
        float: left;
        transform: rotate(90deg);
        transform-origin: right top;
      }
      .image--modal {
        width: 42%;
        height: auto;
        vertical-align: middle;
      }
      .modal {
        background-color: rgba(254,255,255,0.9);
        max-height: none !important;
        max-width: none !important;
        height: 100%;
        width: 100%;
        margin: 0;
        box-shadow: none;
        transform: rotate(90deg) translateY(-50vh);
        transform-origin: right top;
        display: flex;
        align-items: center;
      }
      .modal-text {
        width: 43%;
        height: auto;
        display: inline-block;
        vertical-align: middle;
      }
      .modal-text h2 {
        white-space: normal !important;
      }
      .themeatic {
        margin: 0 auto;
        padding: 10px;
        border: 1px solid #1A09FF;
        width: inherit;
      }
      .buttons {
        position: absolute !important;
        top: 55vh;
      }
    </style>
    <iron-ajax
      auto
      url="{{url}}"
      handle-as="json"
      params="{{params}}"
      last-response="{{response}}"
    ></iron-ajax>
    <div>
      <template is="dom-repeat" items="{{response.records}}">
        <div class='image-wrapper'>
          <img class='image--gallery' on-click="toggleModal" src="{{item.primaryimageurl}}">
        </div>
        <paper-dialog id="artModal" class="modal" horizontal-align="left" vertical-align="top">
          <img class='image--modal' src="{{item.primaryimageurl}}">
          <div class='modal-text'>
            <h2><a href={{item.url}}>{{item.title}}</a></h2>
            <p>{{item.description}}</p>
            <div class='themeatic'>Most Thematically Similar</div>
            <h2><a href={{newsurl}}>{{newstitle}}</a></h2>
            <p>{{newsdesc}}</p>
          </div>
          <div class="buttons">
            <paper-button dialog-dismiss>â¬… BACK</paper-button>
          </div>
        </paper-dialog>
      </template>
  </div>
  </template>

  <script>
    Polymer({
      is: 'keyword-art',
      properties: {
          apikey: {
              value: "9c6efbf0-b43e-11e6-a912-5bf7795f06a9",
              notify: true
          },
          keyword: {
              value: "government",
              notify: true
          },
          url: {
              value: "http://api.harvardartmuseums.org/object"
          },
          params: {
              computed: "computeParams(apikey, keyword)"
          },
          response: {
              value: {},
              notify: true,
              observer: "responseChanged"
          },
          results: {
              type: Number,
              notify: true,
              observer: "resultsChanged"
          }
      },
      toggleModal: function(event){
        event.target.parentElement.nextElementSibling.open();
      },
      resultsChanged: function(r) {

      },
      computeResults: function(r) {
          this.results = r;
      },
      computeParams: function (apikey, keyword) {
          return {apikey: apikey, keyword: keyword, size: 5, hasimage: 1};
      },
      responseChanged: function (resp) {
          if (resp.info) { this.computeResults(resp.info.totalrecords); };
      }
  });
  </script>
</dom-module>
